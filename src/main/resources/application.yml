spring:
  application:
    name: platform-journey-tests

# Configuração padrão E2E
e2e:
  environment: local
  # Multi-Country: País padrão para testes (conforme refatoração multi-country)
  # O código será convertido para lowercase no header HTTP (conforme RFC 6648)
  default-country-code: BR  # Código do país em uppercase
  timeout: 30000
  # Timeouts para eventos assíncronos (mensageria)
  # Considerando cluster local com latência mínima:
  # - Outbox Pattern: até 2s de delay
  # - Processamento: ~100ms
  # - Polling overhead: otimizado para 300ms (balance entre responsividade e overhead)
  # - Margem de segurança: 200ms
  # Total mínimo seguro: ~3 segundos (otimizado de 5s para 3s)
  event-timeout-seconds: 3
  event-poll-interval-ms: 300  # Otimizado de 500ms para 300ms para melhor responsividade
  # Connection Pooling: configurações para otimizar reutilização de conexões HTTP
  http-client:
    max-connections-per-route: 20  # Máximo de conexões por rota (serviço)
    max-total-connections: 100  # Total máximo de conexões
    connection-timeout-ms: 5000  # Timeout para estabelecer conexão (5s)
    socket-timeout-ms: 30000  # Timeout para leitura de dados (30s)
    connection-ttl-ms: 300000  # TTL de conexões idle (5min)
  # Simulação de providers: permite simular envio de mensagens aos providers
  # em ambientes não-PROD, evitando custos e permitindo testes sem dependências externas
  simulate-provider:
    enabled: true  # Default: true para local/sit/uat, false para prod
  # Configuração de retry para rate limiting
  rate-limit-retry:
    max-attempts: 3  # Número máximo de tentativas quando receber 429
    initial-delay-ms: 2000  # Delay inicial em milissegundos (backoff exponencial: 2s, 4s, 8s)
    enabled: true  # Habilitar retry automático para rate limiting
  services:
    identity-url: http://localhost:8084
    auth-url: http://localhost:8080
    profile-url: http://localhost:8088

# Configuração RabbitMQ para testes E2E
rabbitmq:
  host: localhost
  port: 5672
  username: guest
  password: guest
  # Multi-Country: Virtual Host baseado no país (conforme refatoração multi-country)
  # Em desenvolvimento local/low env: usa "/br" (país padrão) - um único broker para um país
  # Em produção: pode usar "/br", "/ar", "/cl", "/bo" conforme país
  # Pode ser sobrescrito via variável de ambiente: RABBITMQ_VIRTUAL_HOST=/br
  virtual-host: ${RABBITMQ_VIRTUAL_HOST:/br}  # Default: "/br" para local/low env (país padrão BR)

